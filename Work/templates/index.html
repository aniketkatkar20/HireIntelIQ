<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Interview System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success: linear-gradient(135deg, #81FBB8 0%, #28C76F 100%);
            --warning: linear-gradient(135deg, #FFD93D 6%, #FF6B6B 100%);
            --error: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --dark-glass: rgba(0, 0, 0, 0.1);
            --text-primary: #1a1a1a;
            --text-secondary: #6b7280;
            --text-light: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23ffffff" fill-opacity="0.05"><circle cx="7" cy="7" r="1"/><circle cx="27" cy="7" r="1"/><circle cx="47" cy="7" r="1"/><circle cx="7" cy="27" r="1"/><circle cx="27" cy="27" r="1"/><circle cx="47" cy="27" r="1"/><circle cx="7" cy="47" r="1"/><circle cx="27" cy="47" r="1"/><circle cx="47" cy="47" r="1"/></g></g></svg>');
            pointer-events: none;
            z-index: 0;
        }

        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            right: 10%;
            animation-delay: -7s;
        }

        .shape:nth-child(3) {
            width: 60px;
            height: 60px;
            top: 80%;
            left: 70%;
            animation-delay: -3s;
        }

        @keyframes float {
            from {
                transform: translateY(0px) rotate(0deg);
            }
            to {
                transform: translateY(-100vh) rotate(360deg);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.8s ease-out;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .header p {
            color: var(--text-light);
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .nav-btn {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 12px 24px;
            color: var(--text-light);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-btn.active {
            background: var(--primary);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }

        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--accent);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .file-upload-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            border: 2px dashed var(--glass-border);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            padding: 24px;
            text-align: center;
        }

        .file-input-container:hover {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.02);
        }

        .file-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .file-label {
            display: block;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .file-label:hover {
            color: #ffffff;
        }

        .file-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            opacity: 0.7;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            font-family: inherit;
            margin: 10px 5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--secondary);
            box-shadow: 0 8px 24px rgba(240, 147, 251, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 12px 32px rgba(240, 147, 251, 0.4);
        }

        .btn-danger {
            background: var(--error);
            box-shadow: 0 8px 24px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 12px 32px rgba(255, 107, 107, 0.4);
        }

        .btn-success {
            background: var(--success);
            box-shadow: 0 8px 24px rgba(129, 251, 184, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 12px 32px rgba(129, 251, 184, 0.4);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            align-items: center;
            margin-bottom: 32px;
        }

        .question-display, .transcript-display {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            min-height: 60px;
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .question-display {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-left: 4px solid #667eea;
        }

        .transcript-display {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
            border-left: 4px solid #4facfe;
            min-height: 100px;
        }

        .hidden {
            display: none;
        }

        .status {
            padding: 16px 20px;
            margin: 16px 0;
            border-radius: 12px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.3s ease-out;
        }

        .status.success {
            background: rgba(129, 251, 184, 0.15);
            color: #10b981;
            border-color: rgba(129, 251, 184, 0.3);
        }

        .status.error {
            background: rgba(255, 107, 107, 0.15);
            color: #ef4444;
            border-color: rgba(255, 107, 107, 0.3);
        }

        .overall-score {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            text-align: center;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-grid {
            display: grid;
            gap: 16px;
            list-style: none;
        }

        .score-item {
            padding: 20px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .score-item:hover {
            transform: translateX(8px);
        }

        .score-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--accent);
        }

        .results-table {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 16px;
            font-weight: 600;
            color: var(--text-light);
            border-bottom: 1px solid var(--glass-border);
        }

        .table-row {
            padding: 16px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 16px;
            color: var(--text-light);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .table-row:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .score-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
        }

        .score-excellent {
            background: rgba(129, 251, 184, 0.2);
            color: #10b981;
            border: 1px solid rgba(129, 251, 184, 0.3);
        }

        .score-good {
            background: rgba(255, 211, 61, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(255, 211, 61, 0.3);
        }

        .score-poor {
            background: rgba(255, 107, 107, 0.2);
            color: #ef4444;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.8rem;
            margin: 0;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .listening-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .listening-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: listening 1.5s infinite ease-in-out;
        }

        .listening-dot:nth-child(2) { animation-delay: 0.2s; }
        .listening-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes listening {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .glass-card {
                padding: 24px;
                margin-bottom: 24px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .btn {
                padding: 14px 24px;
                font-size: 0.9rem;
            }

            .table-header, .table-row {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .navigation {
                flex-direction: column;
                align-items: center;
            }
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .candidate-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            border-left: 4px solid var(--accent);
        }

        .candidate-info h3 {
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .candidate-info p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-state h3 {
            margin-bottom: 16px;
            font-size: 1.5rem;
        }

        .empty-state p {
            font-size: 1rem;
            line-height: 1.6;
        }
                /* Voice Detection Styles */
        .voice-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            color: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .voice-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .voice-header h2 {
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .voice-header p {
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .voice-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .voice-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .voice-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .voice-card h3 {
            margin: 0 0 1rem 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .voice-card .icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .btn-voice {
            width: 100%;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(238, 90, 36, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #54a0ff, #2e86de);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(84, 160, 255, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #5f27cd, #341f97);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(95, 39, 205, 0.4);
        }

        .btn-disabled {
            background: #6c757d;
            color: #fff;
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Status Display */
        .status-display {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .status-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Warning System */
        .warning-system {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .warning-item {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .warning-item.error {
            background: rgba(220, 53, 69, 0.2);
            border-color: rgba(220, 53, 69, 0.5);
        }

        .warning-item.success {
            background: rgba(40, 167, 69, 0.2);
            border-color: rgba(40, 167, 69, 0.5);
        }

        .warning-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .warning-content {
            flex-grow: 1;
        }

        .warning-title {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .warning-message {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Voice Profiles */
        .voice-profiles {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .profile-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-info {
            flex-grow: 1;
        }

        .profile-session {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .profile-date {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 5px;
        }

        /* Recording Animation */
        .recording-indicator {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.5);
            border-radius: 10px;
            margin: 1rem 0;
        }

        .recording-indicator.active {
            display: flex;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background: #dc3545;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Hidden by default */
        .voice-section.hidden {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .voice-controls {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .voice-section {
                padding: 1.5rem;
                margin: 1rem 0;
            }
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>HireIntelIQ</h1>
            <p>Advanced AI-Powered Voice Interview System</p>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-btn active" onclick="showSection('interview')">📝 New Interview</button>
            <button class="nav-btn" onclick="showSection('results')">📊 Results Dashboard</button>
        </div>
        
        <!-- Interview Section -->
        <div id="interview" class="section active">
            <!-- Candidate Info -->
            <div class="glass-card">
                <h2 class="section-title">
                    👤 Candidate Information
                </h2>
                <div class="form-group">
                    <label for="candidateName">Full Name *</label>
                    <input type="text" id="candidateName" class="form-input" placeholder="Enter candidate's full name" required>
                </div>
                <div class="form-group">
                    <label for="candidateEmail">Email Address</label>
                    <input type="email" id="candidateEmail" class="form-input" placeholder="Enter candidate's email address">
                </div>
                <div class="form-group">
                    <label for="candidatePosition">Position Applied For</label>
                    <input type="text" id="candidatePosition" class="form-input" placeholder="e.g. Software Engineer, Data Analyst">
                </div>
            </div>

            <!-- File Upload Section -->
            <div class="glass-card upload-section">
                <h2 class="section-title">
                    📁 Upload Documents
                </h2>
                <div class="file-upload-wrapper">
                    <div class="file-input-container">
                        <div class="file-icon">📄</div>
                        <label for="resume" class="file-label">
                            <strong>Upload Resume</strong><br>
                            <small>PDF, DOCX, or TXT format</small>
                        </label>
                        <input type="file" id="resume" class="file-input" accept=".pdf,.docx,.txt">
                    </div>
                </div>
                <div class="file-upload-wrapper">
                    <div class="file-input-container">
                        <div class="file-icon">📋</div>
                        <label for="jd" class="file-label">
                            <strong>Upload Job Description</strong><br>
                            <small>PDF, DOCX, or TXT format</small>
                        </label>
                        <input type="file" id="jd" class="file-input" accept=".pdf,.docx,.txt">
                    </div>
                </div>
                    <!-- Voice Detection Section - Add this to your existing HTML -->
    <div id="voiceSection" class="voice-section">
        <div class="voice-header">
            <h2>🎤 Voice Authentication System</h2>
            <p>Secure your interview with advanced voice recognition technology</p>
        </div>

        <!-- Audio Device Check -->
        <div class="voice-card">
            <h3>
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M12 2c1.1 0 2 .9 2 2v6c0 1.1-.9 2-2 2s-2-.9-2-2V4c0-1.1.9-2 2-2zm5.3 6.7c0 3-2.54 5.1-5.3 5.1S6.7 11.7 6.7 8.7H5c0 3.41 2.72 6.23 6 6.72V17h-2v2h6v-2h-2v-1.58c3.28-.49 6-3.31 6-6.72h-1.7z"/>
                </svg>
                Audio Device Status
            </h3>
            <button id="checkAudioBtn" class="btn-voice btn-secondary">Check Microphone</button>
            <div id="audioStatus" class="status-item" style="margin-top: 1rem;">
                <div class="status-label">Microphone Status</div>
                <div id="audioStatusValue" class="status-value">Unknown</div>
            </div>
        </div>

        <!-- Voice Registration Controls -->
        <div class="voice-controls">
            <div class="voice-card">
                <h3>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Voice Registration
                </h3>
                <button id="registerVoiceBtn" class="btn-voice btn-primary">Register Voice (10s)</button>
                <button id="testVoiceBtn" class="btn-voice btn-secondary">Quick Test (5s)</button>
                <div class="status-item" style="margin-top: 1rem;">
                    <div class="status-label">Registration Status</div>
                    <div id="registrationStatus" class="status-value">Not Registered</div>
                </div>
            </div>

            <div class="voice-card">
                <h3>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    Voice Profiles
                </h3>
                <button id="loadProfilesBtn" class="btn-voice btn-success">Load Profiles</button>
                <select id="profileSelect" class="btn-voice" style="background: rgba(255,255,255,0.1); color: white; margin-top: 0.5rem;">
                    <option value="">Select a profile...</option>
                </select>
            </div>

            <div class="voice-card">
                <h3>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Monitoring Control
                </h3>
                <button id="startMonitoringBtn" class="btn-voice btn-success btn-disabled" disabled>Start Monitoring</button>
                <button id="stopMonitoringBtn" class="btn-voice btn-secondary" style="display: none;">Stop Monitoring</button>
            </div>
        </div>

        <!-- Recording Indicator -->
        <div id="recordingIndicator" class="recording-indicator">
            <div class="recording-dot"></div>
            <span id="recordingText">Recording voice sample...</span>
        </div>

        <!-- Progress Bar -->
        <div id="progressContainer" class="progress-container" style="display: none;">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div id="progressText" class="progress-text">Preparing...</div>
        </div>

        <!-- Status Display -->
        <div class="status-display">
            <h3 style="margin-top: 0;">Real-time Status</h3>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-label">Voice Warnings</div>
                    <div id="warningCount" class="status-value">0/3</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Malpractice Attempts</div>
                    <div id="malpracticeCount" class="status-value">0/5</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Interview Status</div>
                    <div id="interviewStatus" class="status-value">Ready</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Monitoring</div>
                    <div id="monitoringStatus" class="status-value">Inactive</div>
                </div>
            </div>
        </div>

        <!-- Warning System -->
        <div id="warningSystem" class="warning-system" style="display: none;">
            <h3 style="margin-top: 0;">Alerts & Notifications</h3>
            <div id="alertContainer"></div>
        </div>
    </div>



                <div style="text-align: center; margin-top: 24px;">
                    <button id="startInterview" class="btn">
                        ✨ Generate Questions
                    </button>
                </div>
                <div id="uploadStatus"></div>
            </div>

            <!-- Audio Controls Section -->
            <div id="audioControls" class="hidden">
                <div class="glass-card interview-section">
                    <h2 class="section-title">
                        🎤 Voice Interview
                    </h2>
                    
                    <div id="currentCandidateInfo" class="candidate-info">
                        <h3>Current Candidate: <span id="currentName">-</span></h3>
                        <p>Position: <span id="currentPosition">-</span> | Email: <span id="currentEmail">-</span></p>
                    </div>
                    
                    <p style="color: var(--text-light); margin-bottom: 24px; text-align: center;">
                        Questions have been generated successfully. Click below to begin your voice interview.
                    </p>
                     

                    <div class="controls-grid">
                        <button id="startInterviewVoice" class="btn btn-secondary">
                            🎤 Start Voice Interview
                        </button>
                        <button id="stopButton" class="btn btn-danger">
                            ⏹️ Stop Current Answer
                        </button>
                    </div>
                    
                    <div id="interviewStatus">
                        <h3 style="color: var(--text-light); margin-bottom: 12px; font-weight: 600;">
                            📋 Current Question:
                        </h3>
                        <div id="currentQuestion" class="question-display">
                            Ready to begin interview...
                        </div>
                        
                        <h3 style="color: var(--text-light); margin-bottom: 12px; margin-top: 24px; font-weight: 600;">
                            🗣️ Your Response:
                        </h3>
                        <div id="transcript" class="transcript-display">
                            Waiting for interview to start...
                        </div>
                        
                        <h3 style="color: var(--text-light); margin-bottom: 12px; margin-top: 24px; font-weight: 600;">
                            ✅ Final Answer:
                        </h3>
                        <div id="answer" class="transcript-display">
                            No answer recorded yet...
                        </div>
                    </div>
                </div>

                <!-- Scoring Section -->
                <div class="glass-card scores">
                    <h2 class="section-title">
                        📊 Interview Results
                    </h2>
                    <div id="overallScore" class="overall-score">
                        Scores will appear after interview completion
                    </div>
                    <ul id="scoreList" class="score-grid"></ul>
                    
                    <div style="text-align: center; margin-top: 24px;">
                        <button id="startNewInterview" class="btn btn-success hidden">
                            🔄 Start New Interview
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="section">
            <div class="glass-card">
                <h2 class="section-title">
                    📊 Results Dashboard
                </h2>
                
                <div style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                    <div>
                        <label for="sortBy" style="color: var(--text-light); margin-right: 12px;">Sort by:</label>
                        <select id="sortBy" class="form-input" style="width: auto; display: inline-block;">
                            <option value="score">Overall Score</option>
                            <option value="name">Name</option>
                            <option value="timestamp">Interview Date</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="refreshResults()">🔄 Refresh</button>
                        <button class="btn btn-success" onclick="exportResults()">📥 Export CSV</button>
                        <button class="btn btn-danger" onclick="clearAllResults()">🗑️ Clear All</button>
                    </div>
                </div>

                <div id="resultsContainer">
                    <div class="empty-state">
                        <h3>📋 No Interviews Completed Yet</h3>
                        <p>Complete some interviews to see candidate results and rankings here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form id="resultForm">
  <!-- form fields here -->
  <button type="submit">Submit Result</button>
</form>

<div id="statusMsg" style="margin-top: 10px; color: green;"></div>

<script>

      // Voice Detection JavaScript Integration
        class VoiceDetectionInterface {
            constructor() {
                this.isRegistered = false;
                this.isMonitoring = false;
                this.registrationInProgress = false;
                this.statusCheckInterval = null;
                
                this.initializeEventListeners();
                this.checkAudioAvailability();
                this.startStatusPolling();
            }

            initializeEventListeners() {
                // Audio check
                document.getElementById('checkAudioBtn').addEventListener('click', () => {
                    this.checkAudioAvailability();
                });

                // Voice registration
                document.getElementById('registerVoiceBtn').addEventListener('click', () => {
                    this.registerVoice(10);
                });

                document.getElementById('testVoiceBtn').addEventListener('click', () => {
                    this.testVoiceRegistration(5);
                });

                // Profile management
                document.getElementById('loadProfilesBtn').addEventListener('click', () => {
                    this.loadVoiceProfiles();
                });

                document.getElementById('profileSelect').addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.loadVoiceProfile(e.target.value);
                    }
                });

                // Monitoring control
                document.getElementById('startMonitoringBtn').addEventListener('click', () => {
                    this.startMonitoring();
                });

                document.getElementById('stopMonitoringBtn').addEventListener('click', () => {
                    this.stopMonitoring();
                });
            }

            async checkAudioAvailability() {
                try {
                    this.showProgress(true, 'Checking audio device...');
                    
                    const response = await fetch('/check-audio-availability');
                    const data = await response.json();
                    
                    const statusElement = document.getElementById('audioStatusValue');
                    
                    if (data.available) {
                        statusElement.textContent = 'Available ✓';
                        statusElement.style.color = '#28a745';
                        this.showAlert('Audio device detected successfully', 'success');
                    } else {
                        statusElement.textContent = 'Not Available ✗';
                        statusElement.style.color = '#dc3545';
                        this.showAlert('No audio device detected. Please check your microphone.', 'error');
                    }
                } catch (error) {
                    console.error('Audio check failed:', error);
                    this.showAlert('Failed to check audio device', 'error');
                } finally {
                    this.showProgress(false);
                }
            }

            async registerVoice(duration) {
                if (this.registrationInProgress) return;
                
                try {
                    this.registrationInProgress = true;
                    this.showRecordingIndicator(true, `Recording for ${duration} seconds...`);
                    this.showProgress(true, 'Starting voice registration...');
                    
                    // Start registration
                    const response = await fetch('/start-voice-registration', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ duration })
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        // Show countdown
                        this.showCountdown(duration);
                        
                        // Poll for completion
                        this.pollRegistrationStatus();
                    } else {
                        throw new Error(data.message);
                    }
                } catch (error) {
                    console.error('Registration failed:', error);
                    this.showAlert(`Registration failed: ${error.message}`, 'error');
                    this.registrationInProgress = false;
                    this.showRecordingIndicator(false);
                    this.showProgress(false);
                }
            }

            async testVoiceRegistration(duration) {
                try {
                    this.showProgress(true, 'Testing voice registration...');
                    
                    const response = await fetch('/test-voice-registration', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ duration })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.showAlert('Voice registration test successful!', 'success');
                        this.updateRegistrationStatus(true);
                    } else {
                        this.showAlert('Voice registration test failed', 'error');
                    }
                } catch (error) {
                    console.error('Test failed:', error);
                    this.showAlert('Test failed: ' + error.message, 'error');
                } finally {
                    this.showProgress(false);
                }
            }

            async loadVoiceProfiles() {
                try {
                    this.showProgress(true, 'Loading voice profiles...');
                    
                    const response = await fetch('/get-voice-profiles');
                    const data = await response.json();
                    
                    const select = document.getElementById('profileSelect');
                    select.innerHTML = '<option value="">Select a profile...</option>';
                    
                    data.profiles.forEach(profile => {
                        const option = document.createElement('option');
                        option.value = profile.session_id;
                        option.textContent = `${profile.session_id} (${new Date(profile.timestamp).toLocaleDateString()})`;
                        select.appendChild(option);
                    });
                    
                    this.showAlert(`Loaded ${data.profiles.length} voice profiles`, 'success');
                } catch (error) {
                    console.error('Failed to load profiles:', error);
                    this.showAlert('Failed to load voice profiles', 'error');
                } finally {
                    this.showProgress(false);
                }
            }

            async loadVoiceProfile(sessionId) {
                try {
                    this.showProgress(true, 'Loading voice profile...');
                    
                    const response = await fetch('/load-voice-profile', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ session_id: sessionId })
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        this.updateRegistrationStatus(true);
                        this.showAlert(`Voice profile loaded: ${sessionId}`, 'success');
                    } else {
                        throw new Error(data.message);
                    }
                } catch (error) {
                    console.error('Failed to load profile:', error);
                    this.showAlert('Failed to load voice profile', 'error');
                } finally {
                    this.showProgress(false);
                }
            }

            async startMonitoring() {
                try {
                    this.showProgress(true, 'Starting voice monitoring...');
                    
                    const response = await fetch('/start-audio-monitoring', {
                        method: 'POST'
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        this.isMonitoring = true;
                        this.updateMonitoringUI();
                        this.showAlert('Voice monitoring started', 'success');
                        
                        // Start interview monitoring
                        await fetch('/start-interview-monitoring', { method: 'POST' });
                    } else {
                        throw new Error(data.message);
                    }
                } catch (error) {
                    console.error('Failed to start monitoring:', error);
                    this.showAlert('Failed to start monitoring: ' + error.message, 'error');
                } finally {
                    this.showProgress(false);
                }
            }

            async stopMonitoring() {
                try {
                    await fetch('/stop-audio-monitoring', { method: 'POST' });
                    await fetch('/end-interview-monitoring', { method: 'POST' });
                    
                    this.isMonitoring = false;
                    this.updateMonitoringUI();
                    this.showAlert('Voice monitoring stopped', 'success');
                } catch (error) {
                    console.error('Failed to stop monitoring:', error);
                    this.showAlert('Failed to stop monitoring', 'error');
                }
            }

            showCountdown(duration) {
                let remaining = duration;
                const interval = setInterval(() => {
                    this.showProgress(true, `Recording... ${remaining}s remaining`, ((duration - remaining) / duration) * 100);
                    remaining--;
                    
                    if (remaining < 0) {
                        clearInterval(interval);
                        this.showProgress(true, 'Processing voice data...', 100);
                    }
                }, 1000);
            }

            async pollRegistrationStatus() {
                const pollInterval = setInterval(async () => {
                    try {
                        const response = await fetch('/check-registration-status');
                        const data = await response.json();
                        
                        if (data.registration.status === 'completed') {
                            clearInterval(pollInterval);
                            this.registrationInProgress = false;
                            this.showRecordingIndicator(false);
                            this.showProgress(false);
                            
                            if (data.registration.success) {
                                this.updateRegistrationStatus(true);
                                this.showAlert('Voice registered successfully!', 'success');
                            } else {
                                this.showAlert('Voice registration failed', 'error');
                            }
                        } else if (data.registration.status === 'failed' || data.registration.status === 'error') {
                            clearInterval(pollInterval);
                            this.registrationInProgress = false;
                            this.showRecordingIndicator(false);
                            this.showProgress(false);
                            this.showAlert(`Registration failed: ${data.registration.error}`, 'error');
                        }
                    } catch (error) {
                        console.error('Status poll failed:', error);
                    }
                }, 1000);
            }

            startStatusPolling() {
                this.statusCheckInterval = setInterval(async () => {
                    await this.updateVoiceWarnings();
                    await this.checkInterviewStatus();
                }, 2000);
            }

            async updateVoiceWarnings() {
                try {
                    const response = await fetch('/get-voice-warnings');
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        document.getElementById('warningCount').textContent = `${data.warnings}/${data.max_warnings}`;
                        document.getElementById('malpracticeCount').textContent = `${data.malpractice_count}/${data.max_malpractice}`;
                        
                        // Update colors based on warning level
                        const warningElement = document.getElementById('warningCount');
                        if (data.warnings >= data.max_warnings) {
                            warningElement.style.color = '#dc3545';
                        } else if (data.warnings > 0) {
                            warningElement.style.color = '#ffc107';
                        } else {
                            warningElement.style.color = '#28a745';
                        }
                    }
                } catch (error) {
                    console.error('Failed to update warnings:', error);
                }
            }

            async checkInterviewStatus() {
                try {
                    const response = await fetch('/check-interview-status');
                    const data = await response.json();
                    
                    if (data.interview_status.status === 'cancelled') {
                        document.getElementById('interviewStatus').textContent = 'Cancelled';
                        document.getElementById('interviewStatus').style.color = '#dc3545';
                        this.showAlert(`Interview cancelled: ${data.interview_status.reason}`, 'error');
                    }
                } catch (error) {
                    console.error('Failed to check interview status:', error);
                }
            }

            updateRegistrationStatus(registered) {
                this.isRegistered = registered;
                const statusElement = document.getElementById('registrationStatus');
                const startBtn = document.getElementById('startMonitoringBtn');
                
                if (registered) {
                    statusElement.textContent = 'Registered ✓';
                    statusElement.style.color = '#28a745';
                    startBtn.disabled = false;
                    startBtn.classList.remove('btn-disabled');
                } else {
                    statusElement.textContent = 'Not Registered';
                    statusElement.style.color = '#dc3545';
                    startBtn.disabled = true;
                    startBtn.classList.add('btn-disabled');
                }
            }

            updateMonitoringUI() {
                const startBtn = document.getElementById('startMonitoringBtn');
                const stopBtn = document.getElementById('stopMonitoringBtn');
                const statusElement = document.getElementById('monitoringStatus');
                
                if (this.isMonitoring) {
                    startBtn.style.display = 'none';
                    stopBtn.style.display = 'block';
                    statusElement.textContent = 'Active ✓';
                    statusElement.style.color = '#28a745';
                } else {
                    startBtn.style.display = 'block';
                    stopBtn.style.display = 'none';
                    statusElement.textContent = 'Inactive';
                    statusElement.style.color = '#6c757d';
                }
            }

            showRecordingIndicator(show, text = 'Recording...') {
                const indicator = document.getElementById('recordingIndicator');
                const textElement = document.getElementById('recordingText');
                
                if (show) {
                    indicator.classList.add('active');
                    textElement.textContent = text;
                } else {
                    indicator.classList.remove('active');
                }
            }
            
showProgress(show, text = '', percentage = 0) {
                const container = document.getElementById('progressContainer');
                const fill = document.getElementById('progressFill');
                const textElement = document.getElementById('progressText');
                
                if (show) {
                    container.style.display = 'block';
                    fill.style.width = percentage + '%';
                    textElement.textContent = text;
                } else {
                    container.style.display = 'none';
                    fill.style.width = '0%';
                    textElement.textContent = '';
                }
            }
            showAlert(message, type = 'info') {
                const alertContainer = document.getElementById('alertContainer');
                const warningSystem = document.getElementById('warningSystem');
                
                // Show the warning system if it's hidden
                warningSystem.style.display = 'block';
                
                // Create alert element
                const alertElement = document.createElement('div');
                alertElement.className = `warning-item ${type}`;
                
                // Create icon based on type
                let iconSVG = '';
                let title = '';
                
                switch (type) {
                    case 'success':
                        title = 'Success';
                        iconSVG = `<svg class="warning-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>`;
                        break;
                    case 'error':
                        title = 'Error';
                        iconSVG = `<svg class="warning-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/>
                        </svg>`;
                        break;
                    default:
                        title = 'Info';
                        iconSVG = `<svg class="warning-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                        </svg>`;
                }
                
                alertElement.innerHTML = `
                    ${iconSVG}
                    <div class="warning-content">
                        <div class="warning-title">${title}</div>
                        <div class="warning-message">${message}</div>
                    </div>
                `;
                
                // Add to container
                alertContainer.appendChild(alertElement);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (alertElement.parentNode) {
                        alertElement.remove();
                        
                        // Hide warning system if no alerts remain
                        if (alertContainer.children.length === 0) {
                            warningSystem.style.display = 'none';
                        }
                    }
                }, 5000);
            }

            // Cleanup method
            destroy() {
                if (this.statusCheckInterval) {
                    clearInterval(this.statusCheckInterval);
                }
                
                // Stop monitoring if active
                if (this.isMonitoring) {
                    this.stopMonitoring();
                }
            }

            // Additional utility methods
            async getSystemStatus() {
                try {
                    const response = await fetch('/get-system-status');
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Failed to get system status:', error);
                    return null;
                }
            }

            async exportVoiceData() {
                try {
                    this.showProgress(true, 'Exporting voice data...');
                    
                    const response = await fetch('/export-voice-data');
                    const blob = await response.blob();
                    
                    // Create download link
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `voice_data_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    this.showAlert('Voice data exported successfully', 'success');
                } catch (error) {
                    console.error('Export failed:', error);
                    this.showAlert('Failed to export voice data', 'error');
                } finally {
                    this.showProgress(false);
                }
            }

            async resetVoiceSystem() {
                try {
                    this.showProgress(true, 'Resetting voice system...');
                    
                    const response = await fetch('/reset-voice-system', {
                        method: 'POST'
                    });
                    
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        // Reset UI state
                        this.isRegistered = false;
                        this.isMonitoring = false;
                        this.updateRegistrationStatus(false);
                        this.updateMonitoringUI();
                        
                        // Clear alerts
                        document.getElementById('alertContainer').innerHTML = '';
                        document.getElementById('warningSystem').style.display = 'none';
                        
                        // Reset counters
                        document.getElementById('warningCount').textContent = '0/3';
                        document.getElementById('malpracticeCount').textContent = '0/5';
                        document.getElementById('interviewStatus').textContent = 'Ready';
                        
                        this.showAlert('Voice system reset successfully', 'success');
                    } else {
                        throw new Error(data.message);
                    }
                } catch (error) {
                    console.error('Reset failed:', error);
                    this.showAlert('Failed to reset voice system', 'error');
                } finally {
                    this.showProgress(false);
                }
            }

            // Enhanced error handling
            handleError(error, context = '') {
                console.error(`Voice Detection Error ${context}:`, error);
                
                let message = 'An unexpected error occurred';
                
                if (error.name === 'NetworkError' || error.message.includes('fetch')) {
                    message = 'Network connection error. Please check your internet connection.';
                } else if (error.name === 'NotAllowedError') {
                    message = 'Microphone access denied. Please allow microphone permissions.';
                } else if (error.name === 'TimeoutError') {
                    message = 'Request timed out. Please try again.';
                } else if (error.message) {
                    message = error.message;
                }
                
                this.showAlert(`${context} ${message}`, 'error');
            }

            // Voice quality check
            async checkVoiceQuality() {
                try {
                    this.showProgress(true, 'Checking voice quality...');
                    
                    const response = await fetch('/check-voice-quality');
                    const data = await response.json();
                    
                    if (data.quality_score >= 0.8) {
                        this.showAlert(`Voice quality: Excellent (${Math.round(data.quality_score * 100)}%)`, 'success');
                    } else if (data.quality_score >= 0.6) {
                        this.showAlert(`Voice quality: Good (${Math.round(data.quality_score * 100)}%)`, 'info');
                    } else {
                        this.showAlert(`Voice quality: Poor (${Math.round(data.quality_score * 100)}%). Consider adjusting your microphone.`, 'error');
                    }
                } catch (error) {
                    this.handleError(error, 'Voice quality check failed:');
                } finally {
                    this.showProgress(false);
                }
            }
        }

        // Initialize the voice detection interface when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            try {
                window.voiceInterface = new VoiceDetectionInterface();
                console.log('Voice Detection Interface initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Voice Detection Interface:', error);
                
                // Show error message to user
                const errorDiv = document.createElement('div');
                errorDiv.className = 'warning-item error';
                errorDiv.innerHTML = `
                    <svg class="warning-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/>
                    </svg>
                    <div class="warning-content">
                        <div class="warning-title">Initialization Error</div>
                        <div class="warning-message">Failed to initialize voice detection system. Please refresh the page.</div>
                    </div>
                `;
                
                const voiceSection = document.getElementById('voiceSection');
                if (voiceSection) {
                    voiceSection.insertBefore(errorDiv, voiceSection.firstChild);
                }
            }
        });

        // Handle page unload
        window.addEventListener('beforeunload', function() {
            if (window.voiceInterface) {
                window.voiceInterface.destroy();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (!window.voiceInterface) return;
            
            // Alt + R for registration
            if (event.altKey && event.key === 'r') {
                event.preventDefault();
                document.getElementById('registerVoiceBtn').click();
            }
            
            // Alt + M for monitoring toggle
            if (event.altKey && event.key === 'm') {
                event.preventDefault();
                if (window.voiceInterface.isMonitoring) {
                    document.getElementById('stopMonitoringBtn').click();
                } else {
                    document.getElementById('startMonitoringBtn').click();
                }
            }
            
            // Alt + T for test
            if (event.altKey && event.key === 't') {
                event.preventDefault();
                document.getElementById('testVoiceBtn').click();
            }
        });

        // Periodic health check
        setInterval(async function() {
            if (window.voiceInterface) {
                try {
                    const status = await window.voiceInterface.getSystemStatus();
                    if (status && status.status === 'error') {
                        window.voiceInterface.showAlert('System health check failed', 'error');
                    }
                } catch (error) {
                    console.error('Health check failed:', error);
                }
            }
        }, 30000); // Every 30 seconds


  document.getElementById('resultForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = {
      name: document.getElementById('name').value,
      score: document.getElementById('score').value,
    };

    const response = await fetch('/submit-result', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formData)
    });

    const result = await response.json();

    const msgDiv = document.getElementById('statusMsg');
    msgDiv.textContent = result.message;

    if (result.status === 'success') {
      msgDiv.style.color = 'green';
    } else {
      msgDiv.style.color = 'red';
    }
  });
</script>

<script>
  // Voice Interview System JavaScript
// Enhanced Voice Interview System JavaScript
class VoiceInterviewSystem {
    constructor() {
        this.recognition = null;
        this.synthesis = null;
        this.speechSynthesisUtterance = null;
        this.isListening = false;
        this.isInterviewActive = false;
        this.currentQuestionIndex = 0;
        this.questions = [];
        this.qaPairs = [];
        this.currentTranscript = '';
        this.candidateInfo = {};
        this.results = [];
        this.timer = null;
        
        this.initializeSpeechAPI();
        this.bindEvents();
        this.loadResults();
    }

    initializeSpeechAPI() {
        // Check speech synthesis support
        if (!('speechSynthesis' in window)) {
            this.showStatus('error', 'Speech synthesis is not supported in your browser. Please use Chrome, Firefox, or Safari.');
            return;
        }
        
        // Check speech recognition support
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            this.showStatus('error', 'Speech recognition is not supported in your browser. Please use Chrome or Safari.');
            return;
        }

        // Initialize Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        this.recognition = new SpeechRecognition();
        this.recognition.continuous = true;
        this.recognition.interimResults = true;
        this.recognition.lang = 'en-US';
        this.recognition.maxAlternatives = 1;

        // Initialize Speech Synthesis
        this.synthesis = window.speechSynthesis;

        this.showStatus('success', '🚀 Voice interview system ready and optimized!');
    }

    bindEvents() {
        // Wait for page to load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page loaded, setting up event listeners...');
        });

        // File input events
        const resumeInput = document.getElementById('resume');
        const jdInput = document.getElementById('jd');
        
        if (resumeInput) resumeInput.addEventListener('change', this.handleFileSelect.bind(this));
        if (jdInput) jdInput.addEventListener('change', this.handleFileSelect.bind(this));
        
        // Button events
        const startInterviewBtn = document.getElementById('startInterview');
        const startVoiceBtn = document.getElementById('startInterviewVoice');
        const stopBtn = document.getElementById('stopButton');
        const newInterviewBtn = document.getElementById('startNewInterview');
        const sortSelect = document.getElementById('sortBy');
        
        if (startInterviewBtn) startInterviewBtn.addEventListener('click', this.generateQuestions.bind(this));
        if (startVoiceBtn) startVoiceBtn.addEventListener('click', this.startVoiceInterview.bind(this));
        if (stopBtn) stopBtn.addEventListener('click', this.stopCurrentAnswer.bind(this));
        if (newInterviewBtn) newInterviewBtn.addEventListener('click', this.startNewInterview.bind(this));
        if (sortSelect) sortSelect.addEventListener('change', this.sortResults.bind(this));
    }

    handleFileSelect(event) {
        const file = event.target.files[0];
        const container = event.target.closest('.file-input-container');
        const label = container?.querySelector('.file-label');
        
        if (file && label) {
            label.innerHTML = `<strong>✅ ${file.name}</strong><br><small>File selected successfully</small>`;
            if (container) {
                container.style.borderColor = 'rgba(129, 251, 184, 0.4)';
                container.style.background = 'rgba(129, 251, 184, 0.1)';
            }
        }
    }

    async generateQuestions() {
        const candidateNameEl = document.getElementById('candidateName');
        const candidateEmailEl = document.getElementById('candidateEmail');
        const candidatePositionEl = document.getElementById('candidatePosition');
        const resumeFile = document.getElementById('resume')?.files[0];
        const jdFile = document.getElementById('jd')?.files[0];

        const candidateName = candidateNameEl?.value.trim() || '';
        const candidateEmail = candidateEmailEl?.value.trim() || '';
        const candidatePosition = candidatePositionEl?.value.trim() || '';

        if (!candidateName && candidateNameEl) {
            this.showStatus('error', 'Please enter candidate name');
            return;
        }

        if (!resumeFile || !jdFile) {
            this.showStatus('error', '⚠️ Please upload both files to continue.');
            return;
        }

        this.candidateInfo = {
            name: candidateName,
            email: candidateEmail,
            position: candidatePosition
        };

        this.showStatus('success', '🔄 Uploading files and generating intelligent questions...');
        const startBtn = document.getElementById('startInterview');
        if (startBtn) {
            startBtn.disabled = true;
            startBtn.classList.add('pulse');
        }

        const formData = new FormData();
        formData.append('resume', resumeFile);
        formData.append('jd', jdFile);

        try {
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            console.log('Upload response:', result);

            if (result.status === 'success') {
                this.questions = result.result?.questions || [];
                console.log('Questions loaded:', this.questions.length, 'questions');
                
                if (this.questions.length === 0) {
                    this.showStatus('error', '❌ No questions were generated. Please check your files and try again.');
                    if (startBtn) {
                        startBtn.disabled = false;
                        startBtn.classList.remove('pulse');
                    }
                    return;
                }
                
                this.showAudioControls();
                this.showStatus('success', `✅ Perfect! ${this.questions.length} intelligent questions generated. Ready for your voice interview.`);
                if (startBtn) startBtn.classList.remove('pulse');
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            console.error('Upload error:', error);
            this.showStatus('error', `❌ Upload failed: ${error.message}`);
        } finally {
            if (startBtn) {
                startBtn.disabled = false;
                startBtn.classList.remove('pulse');
            }
        }
    }

    showAudioControls() {
        const audioControls = document.getElementById('audioControls');
        if (audioControls) {
            audioControls.classList.remove('hidden');
            
            const currentNameEl = document.getElementById('currentName');
            const currentEmailEl = document.getElementById('currentEmail');
            const currentPositionEl = document.getElementById('currentPosition');
            
            if (currentNameEl) currentNameEl.textContent = this.candidateInfo.name;
            if (currentEmailEl) currentEmailEl.textContent = this.candidateInfo.email || 'Not provided';
            if (currentPositionEl) currentPositionEl.textContent = this.candidateInfo.position || 'Not specified';
            
            // Scroll to audio controls
            audioControls.scrollIntoView({ behavior: 'smooth' });
        }
    }

    async startVoiceInterview() {
        console.log('Start Voice Interview clicked');
        
        if (this.isInterviewActive) {
            this.showStatus('error', '⚠️ Interview is already in progress.');
            return;
        }
        
        if (this.questions.length === 0) {
            this.showStatus('error', '⚠️ No questions available. Please upload files first.');
            return;
        }
        
        this.isInterviewActive = true;
        this.currentQuestionIndex = 0;
        this.qaPairs = [];
        
        // Show interview is starting
        const currentQuestionEl = document.getElementById('currentQuestion');
        const transcriptEl = document.getElementById('transcript');
        const answerEl = document.getElementById('answer');
        
        if (currentQuestionEl) currentQuestionEl.innerHTML = '🚀 <span class="pulse">Starting your interview...</span>';
        if (transcriptEl) transcriptEl.textContent = '';
        if (answerEl) answerEl.textContent = '';
        
        const startVoiceBtn = document.getElementById('startInterviewVoice');
        if (startVoiceBtn) startVoiceBtn.disabled = true;
        
        console.log('Starting voice interview with', this.questions.length, 'questions');
        this.runVoiceInterview();
    }

    runVoiceInterview() {
        if (this.currentQuestionIndex >= this.questions.length) {
            console.log('Interview completed');
            this.isInterviewActive = false;
            const startVoiceBtn = document.getElementById('startInterviewVoice');
            if (startVoiceBtn) startVoiceBtn.disabled = false;
            
            this.speak("🎉 Interview completed successfully! Thank you for your time. Now calculating your scores...", () => {
                setTimeout(() => this.submitTranscriptForScoring(), 2000);
            });
            return;
        }

        const question = this.questions[this.currentQuestionIndex];
        console.log(`Question ${this.currentQuestionIndex + 1}/${this.questions.length}: ${question}`);
        
        const currentQuestionEl = document.getElementById('currentQuestion');
        const transcriptEl = document.getElementById('transcript');
        const answerEl = document.getElementById('answer');
        
        if (currentQuestionEl) {
            currentQuestionEl.innerHTML = `
                <strong>Question ${this.currentQuestionIndex + 1} of ${this.questions.length}:</strong><br><br>
                ${question}
            `;
        }
        if (transcriptEl) transcriptEl.innerHTML = '🎯 <span class="pulse">Preparing to ask question...</span>';
        if (answerEl) answerEl.textContent = '';

        // Add a delay to ensure UI updates before speaking
        setTimeout(() => {
            this.speak(question, () => {
                console.log('Question spoken, starting to listen...');
                setTimeout(() => this.startListening(question), 1000);
            });
        }, 1000);
    }

    speak(text, callback) {
        console.log('Speaking:', text.substring(0, 50) + '...');
        
        // Cancel any ongoing speech
        if (this.synthesis) {
            this.synthesis.cancel();
        }
        
        // Wait for cancellation to complete
        setTimeout(() => {
            if (!text || text.trim() === '') {
                console.error('Empty text to speak');
                if (callback) callback();
                return;
            }
            
            this.speechSynthesisUtterance = new SpeechSynthesisUtterance(text);
            this.speechSynthesisUtterance.lang = 'en-US';
            this.speechSynthesisUtterance.rate = 0.8;
            this.speechSynthesisUtterance.pitch = 1.0;
            this.speechSynthesisUtterance.volume = 0.9;
            
            this.speechSynthesisUtterance.onstart = () => {
                console.log('Speech started');
            };
            
            this.speechSynthesisUtterance.onend = () => {
                console.log('Speech ended');
                if (callback) {
                    setTimeout(callback, 500);
                }
            };
            
            this.speechSynthesisUtterance.onerror = (event) => {
                console.error('Speech error:', event.error);
                if (callback) {
                    setTimeout(callback, 500);
                }
            };
            
            try {
                if (this.synthesis) {
                    this.synthesis.speak(this.speechSynthesisUtterance);
                }
            } catch (error) {
                console.error('Speech synthesis error:', error);
                if (callback) callback();
            }
        }, 200);
    }

    startListening(question) {
        console.log('Starting speech recognition for question:', question.substring(0, 30) + '...');
        
        if (!this.recognition) {
            this.showStatus('error', 'Speech recognition not supported');
            return;
        }

        try {
            let finalTranscript = "";
            this.isListening = false;

            // Reset recognition handlers
            this.recognition.onstart = () => {
                console.log('Speech recognition started');
                this.isListening = true;
                const transcriptEl = document.getElementById('transcript');
                if (transcriptEl) {
                    transcriptEl.innerHTML = `
                        🎤 <span class="listening-indicator">
                            <span class="listening-dot"></span>
                            <span class="listening-dot"></span>
                            <span class="listening-dot"></span>
                        </span> 
                        Listening... Please speak your answer clearly.
                    `;
                }
            };

            this.recognition.onresult = (event) => {
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                const displayText = (finalTranscript + interimTranscript).trim();
                const transcriptEl = document.getElementById('transcript');
                if (displayText && transcriptEl) {
                    transcriptEl.textContent = displayText;
                }
            };

            this.recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                this.isListening = false;
                clearTimeout(this.timer);
                
                let errorMessage = '❌ Speech recognition error: ';
                switch(event.error) {
                    case 'no-speech':
                        errorMessage += 'No speech detected. Please try again.';
                        break;
                    case 'audio-capture':
                        errorMessage += 'Microphone not found. Please check your microphone.';
                        break;
                    case 'not-allowed':
                        errorMessage += 'Microphone access denied. Please allow microphone access and refresh the page.';
                        break;
                    case 'network':
                        errorMessage += 'Network error. Please check your internet connection.';
                        break;
                    default:
                        errorMessage += event.error;
                }
                
                this.showStatus('error', errorMessage);
                
                // Ask if user wants to retry or skip
                if (confirm('Would you like to try again? Click Cancel to skip this question.')) {
                    setTimeout(() => this.startListening(question), 2000);
                } else {
                    // Skip this question
                    this.currentQuestionIndex++;
                    setTimeout(() => this.runVoiceInterview(), 1000);
                }
            };

            this.recognition.onend = () => {
                console.log('Speech recognition ended');
                this.isListening = false;
                clearTimeout(this.timer);

                const answer = finalTranscript.trim();
                
                if (!answer || answer.length < 3) {
                    console.log('No valid answer detected');
                    const transcriptEl = document.getElementById('transcript');
                    if (transcriptEl) transcriptEl.textContent = 'No clear answer detected.';
                    
                    if (confirm('No clear answer was detected. Would you like to try again?')) {
                        setTimeout(() => this.startListening(question), 2000);
                        return;
                    } else {
                        // Use "No response" as answer
                        finalTranscript = "No response provided";
                    }
                }

                const finalAnswer = finalTranscript.trim() || "No response provided";
                console.log('Final answer:', finalAnswer.substring(0, 50) + '...');
                
                this.qaPairs.push({ question, answer: finalAnswer });
                const answerEl = document.getElementById('answer');
                if (answerEl) answerEl.textContent = finalAnswer;

                // Save the answer
                this.saveTranscript(question, finalAnswer);

                // Move to next question
                this.currentQuestionIndex++;
                setTimeout(() => this.runVoiceInterview(), 2000);
            };

            this.recognition.start();

            // Auto stop after 2 minutes
            this.timer = setTimeout(() => {
                console.log('Auto-stopping recognition after 2 minutes');
                if (this.isListening) {
                    this.recognition.stop();
                }
            }, 60000);

        } catch (error) {
            console.error('Error starting speech recognition:', error);
            this.showStatus('error', '❌ Failed to start speech recognition: ' + error.message);
        }
    }

    stopCurrentAnswer() {
        console.log('Manual stop clicked');
        clearTimeout(this.timer);
        if (this.isListening && this.recognition) {
            this.recognition.stop();
        }
    }

    async saveTranscript(question, answer) {
        try {
            const response = await fetch('/save-transcript', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    question: question,
                    answer: answer
                })
            });

            if (!response.ok) {
                console.error('Failed to save transcript');
            }
            const data = await response.json();
            console.log('Transcript saved:', data);
        } catch (error) {
            console.error('Error saving transcript:', error);
        }
    }

    async submitTranscriptForScoring() {
        console.log('Submitting transcript for scoring...');
        
        const currentQuestionEl = document.getElementById('currentQuestion');
        const transcriptEl = document.getElementById('transcript');
        
        if (currentQuestionEl) currentQuestionEl.innerHTML = '📊 <span class="pulse">Calculating your scores...</span>';
        if (transcriptEl) transcriptEl.textContent = 'Please wait while we analyze your responses with advanced AI...';
        
        try {
            const response = await fetch('/score-transcript');
            
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            
            const data = await response.json();
            console.log('Scoring data received:', data);

            if (data.status !== 'success') {
                this.showStatus('error', '❌ Error fetching score: ' + data.message);
                return;
            }

            // Display results
            this.displayScores(data.scores);
        } catch (error) {
            console.error('Error fetching score:', error);
            this.showStatus('error', '❌ Error calculating scores: ' + error.message);
        }
    }

    displayScores(scores) {
        const currentQuestionEl = document.getElementById('currentQuestion');
        const transcriptEl = document.getElementById('transcript');
        const scoreListEl = document.getElementById('scoreList');
        const overallScoreEl = document.getElementById('overallScore');
        
        if (currentQuestionEl) currentQuestionEl.innerHTML = '🎯 <strong>Interview Complete - Results Ready</strong>';
        if (transcriptEl) transcriptEl.textContent = '✨ Thank you for completing the interview! Your results are displayed below.';
        
        if (scoreListEl) {
            scoreListEl.innerHTML = '';
            
            if (scores && scores.scores && Array.isArray(scores.scores)) {
                scores.scores.forEach((scoreObj, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${scoreObj.progress}</strong><br>
                        <span style="font-size: 1.2em; font-weight: 600;">Score: ${scoreObj.score}%</span>
                    `;
                    li.className = 'score-item';
                    
                    // Color coding based on score
                    if (scoreObj.score >= 70) {
                        li.style.background = 'rgba(129, 251, 184, 0.15)';
                        li.style.borderColor = 'rgba(129, 251, 184, 0.3)';
                        li.style.color = '#10b981';
                    } else if (scoreObj.score >= 50) {
                        li.style.background = 'rgba(255, 211, 61, 0.15)';
                        li.style.borderColor = 'rgba(255, 211, 61, 0.3)';
                        li.style.color = '#f59e0b';
                    } else {
                        li.style.background = 'rgba(255, 107, 107, 0.15)';
                        li.style.borderColor = 'rgba(255, 107, 107, 0.3)';
                        li.style.color = '#ef4444';
                    }
                    
                    scoreListEl.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'No detailed scores available';
                li.className = 'score-item';
                scoreListEl.appendChild(li);
            }
        }

        if (overallScoreEl) {
            if (scores && !isNaN(scores.overall)) {
                const overall = scores.overall;
                overallScoreEl.innerHTML = `
                    <div style="margin-bottom: 8px;">Overall Performance</div>
                    <div style="font-size: 3rem;">${overall.toFixed(1)}%</div>
                    <div style="font-size: 1rem; opacity: 0.8;">
                        ${overall >= 70 ? '🎉 Excellent Performance!' : overall >= 50 ? '👍 Good Performance!' : '💪 Room for Improvement'}
                    </div>
                `;
                overallScoreEl.style.color = overall >= 70 ? '#10b981' : overall >= 50 ? '#f59e0b' : '#ef4444';
            } else {
                overallScoreEl.innerHTML = `
                    <div style="font-size: 1.5rem;">Overall score not available</div>
                `;
            }
        }
        
        // Show completion message
        setTimeout(() => {
            const finalScore = scores.overall ? scores.overall.toFixed(1) + '%' : 'not available';
            this.showStatus('success', `🎉 Interview completed successfully! Your overall score is ${finalScore}`);
        }, 1000);

        // Save to results
        if (scores && scores.overall) {
            this.saveInterviewResult(scores);
        }
    }

    saveInterviewResult(scores) {
        const result = {
            id: Date.now(),
            name: this.candidateInfo.name,
            email: this.candidateInfo.email,
            position: this.candidateInfo.position,
            score: Math.round(scores.overall),
            timestamp: new Date().toISOString(),
            qaPairs: this.qaPairs,
            detailedScores: scores.scores || []
        };

        this.results.push(result);
        this.saveResults();
    }

    startNewInterview() {
        // Reset form
        const candidateNameEl = document.getElementById('candidateName');
        const candidateEmailEl = document.getElementById('candidateEmail');
        const candidatePositionEl = document.getElementById('candidatePosition');
        const resumeEl = document.getElementById('resume');
        const jdEl = document.getElementById('jd');
        
        if (candidateNameEl) candidateNameEl.value = '';
        if (candidateEmailEl) candidateEmailEl.value = '';
        if (candidatePositionEl) candidatePositionEl.value = '';
        if (resumeEl) resumeEl.value = '';
        if (jdEl) jdEl.value = '';
        
        // Reset file input displays
        document.querySelectorAll('.file-input-container').forEach(container => {
            const label = container.querySelector('.file-label');
            const input = container.querySelector('input');
            if (label && input) {
                const isResume = input.id === 'resume';
                label.innerHTML = isResume ? 
                    '<strong>Upload Resume</strong><br><small>PDF, DOCX, or TXT format</small>' :
                    '<strong>Upload Job Description</strong><br><small>PDF, DOCX, or TXT format</small>';
                container.style.borderColor = 'var(--glass-border)';
                container.style.background = 'rgba(255, 255, 255, 0.05)';
            }
        });

        // Hide audio controls
        const audioControls = document.getElementById('audioControls');
        const startNewBtn = document.getElementById('startNewInterview');
        if (audioControls) audioControls.classList.add('hidden');
        if (startNewBtn) startNewBtn.classList.add('hidden');
        
        // Reset state
        this.currentQuestionIndex = 0;
        this.questions = [];
        this.qaPairs = [];
        this.candidateInfo = {};
        this.isInterviewActive = false;
        
        // Clear status
        const uploadStatus = document.getElementById('uploadStatus');
        if (uploadStatus) uploadStatus.innerHTML = '';
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    showStatus(type, message) {
        const statusDiv = document.getElementById('uploadStatus');
        if (statusDiv) {
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }
    }

    // Results Management
    loadResults() {
        try {
            const saved = localStorage.getItem('voiceInterviewResults');
            if (saved) {
                this.results = JSON.parse(saved);
            }
        } catch (error) {
            console.error('Error loading results:', error);
            this.results = [];
        }
    }

    saveResults() {
        try {
            localStorage.setItem('voiceInterviewResults', JSON.stringify(this.results));
        } catch (error) {
            console.error('Error saving results:', error);
        }
    }

    sortResults() {
        const sortByEl = document.getElementById('sortBy');
        if (!sortByEl) return;
        
        const sortBy = sortByEl.value;
        
        this.results.sort((a, b) => {
            switch (sortBy) {
                case 'score':
                    return b.score - a.score;
                case 'name':
                    return a.name.localeCompare(b.name);
                case 'timestamp':
                    return new Date(b.timestamp) - new Date(a.timestamp);
                default:
                    return 0;
            }
        });
        
        this.displayResultsTable();
    }

    displayResultsTable() {
        const container = document.getElementById('resultsContainer');
        if (!container) return;
        
        if (this.results.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>📋 No Interviews Completed Yet</h3>
                    <p>Complete some interviews to see candidate results and rankings here.</p>
                </div>
            `;
            return;
        }

        let tableHTML = `
            <div class="results-table">
                <div class="table-header">
                    <div>Candidate Details</div>
                    <div>Overall Score</div>
                    <div>Interview Date</div>
                    <div>Actions</div>
                </div>
        `;

        this.results.forEach((result, index) => {
            const date = new Date(result.timestamp).toLocaleDateString();
            const scoreBadgeClass = this.getScoreBadgeClass(result.score);
            
            tableHTML += `
                <div class="table-row" data-index="${index}">
                    <div>
                        <strong>${result.name}</strong><br>
                        <small style="opacity: 0.7;">${result.position || 'Position not specified'}</small><br>
                        <small style="opacity: 0.6;">${result.email || 'Email not provided'}</small>
                    </div>
                    <div>
                        <span class="score-badge ${scoreBadgeClass}">${result.score}%</span>
                    </div>
                    <div>${date}</div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary btn-small" onclick="voiceSystem.viewDetails(${index})">
                            👁️ View
                        </button>
                        <button class="btn btn-danger btn-small" onclick="voiceSystem.deleteResult(${index})">
                            🗑️ Delete
                        </button>
                    </div>
                </div>
            `;
        });

        tableHTML += '</div>';
        container.innerHTML = tableHTML;
    }

    getScoreBadgeClass(score) {
        if (score >= 80) return 'score-excellent';
        if (score >= 60) return 'score-good';
        return 'score-poor';
    }

    viewDetails(index) {
        const result = this.results[index];
        const categories = result.detailedScores || [];
        const categoryText = categories.length > 0 ? 
            categories.map(cat => `${cat.progress}: ${cat.score}%`).join('\n') :
            'No detailed breakdown available';
            
        alert(`
Candidate: ${result.name}
Position: ${result.position || 'Not specified'}
Email: ${result.email || 'Not provided'}
Overall Score: ${result.score}%
Interview Date: ${new Date(result.timestamp).toLocaleString()}

Category Breakdown:
${categoryText}
        `);
    }

    deleteResult(index) {
        if (confirm('Are you sure you want to delete this interview result?')) {
            this.results.splice(index, 1);
            this.saveResults();
            this.displayResultsTable();
        }
    }
}

// Navigation Functions
function showSection(sectionName) {
    // Hide all sections
    document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Remove active class from all nav buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected section
    const targetSection = document.getElementById(sectionName);
    if (targetSection) targetSection.classList.add('active');
    
    // Add active class to clicked button
    if (event && event.target) {
        event.target.classList.add('active');
    }
    
    // Load results if results section is selected
    if (sectionName === 'results' && window.voiceSystem) {
        window.voiceSystem.displayResultsTable();
    }
}

// Results Dashboard Functions
function refreshResults() {
    voiceSystem.displayResultsTable();
    voiceSystem.showStatus('success', 'Results refreshed successfully');
}

function exportResults() {
    if (voiceSystem.results.length === 0) {
        alert('No results to export');
        return;
    }

    const csvContent = [
        ['Name', 'Email', 'Position', 'Overall Score', 'Interview Date'],
        ...voiceSystem.results.map(result => [
            result.name,
            result.email || '',
            result.position || '',
            result.score,
            new Date(result.timestamp).toLocaleDateString()
        ])
    ].map(row => row.join(',')).join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'interview_results.csv';
    a.click();
    window.URL.revokeObjectURL(url);
}

function clearAllResults() {
    if (confirm('Are you sure you want to delete all interview results? This action cannot be undone.')) {
        voiceSystem.results = [];
        voiceSystem.saveResults();
        voiceSystem.displayResultsTable();
        voiceSystem.showStatus('success', 'All results cleared successfully');
    }
}

// Initialize the system
let voiceSystem;
document.addEventListener('DOMContentLoaded', () => {
    voiceSystem = new VoiceInterviewSystem();
});
</script>
</body>
</html>
